# 공간 기반 아키텍처 브리핑

## 요약

**공간 기반 아키텍처(Space-Based Architecture)** 는 높은 수준의 **확장성**, **탄력성**, **동시성**을 요구하는 애플리케이션의 문제를 해결하기 위해 특별히 설계된 스타일입니다. 이 아키텍처의 핵심은 시스템의 동기적 제약 요소인 **중앙 데이터베이스**를 **복제된 인메모리 데이터 그리드**로 대체하는 것입니다. 이를 통해 **데이터베이스 병목 현상**을 제거하고 사실상 **무한한 확장**을 가능하게 합니다.

애플리케이션 데이터는 **메모리에 유지**되고 모든 활성 **처리 장치(Processing Unit)** 에 복제됩니다. 데이터 업데이트는 **데이터 펌프(Data Pump)** 를 통해 **비동기적으로** 데이터베이스에 전달됩니다. 이 접근 방식은 극단적이고 예측 불가능한 사용자 부하에 효과적으로 대응할 수 있게 해줍니다.

주요 강점은 **응답성**, **확장성**, **탄력성**이며, 수백만 동시 사용자 처리에 적합합니다. 반면, 아키텍처의 **복잡성**, **캐싱과 데이터 동기화** 관리의 어려움, 높은 비용, 그리고 대규모 부하를 시뮬레이션해야 하는 **테스트의 어려움**은 주요 단점으로 꼽힙니다. 따라서 이 아키텍처는 콘서트 티켓 예매나 온라인 경매 시스템과 같이 **변동성이 큰 극단적인 부하 처리**가 필요한 특정 문제 영역에 적합한 전문화된 스타일로 간주됩니다.


--------------------------------------------------------------------------------


## 1. 전통적인 웹 아키텍처의 확장성 한계

대부분의 웹 기반 비즈니스 애플리케이션은 브라우저에서 웹 서버, 애플리케이션 서버, 데이터베이스 서버로 이어지는 일반적인 요청 흐름을 따릅니다. 이 구조는 소수의 동시 사용자에게는 효과적이지만, 사용자 부하가 증가하면 **병목 현상**이 발생합니다.

* **병목 현상의 이동**: 일반적으로 웹 서버에서 시작된 병목은 애플리케이션 서버를 거쳐 최종적으로 데이터베이스 서버로 이동합니다.
* **확장의 어려움**: 웹 서버 확장은 비교적 쉽고 저렴하지만, 병목을 애플리케이션 서버로 옮길 뿐입니다. 애플리케이션 서버 확장은 더 복잡하고 비용이 많이 들며, 결국 데이터베이스 확장의 문제에 직면하게 됩니다. 데이터베이스는 확장하기가 가장 어렵고 비용이 많이 드는 구성 요소입니다.
* **삼각형 토폴로지**: 이러한 확장 과정은 확장하기 쉬운 웹 서버가 가장 넓은 부분을, 확장하기 가장 어려운 데이터베이스가 가장 좁은 부분을 차지하는 **'삼각형 토폴로지'** 를 형성합니다. 대용량 트래픽을 처리하는 애플리케이션에서 데이터베이스는 **동시 트랜잭션 처리량의 궁극적인 제한 요소**가 됩니다.

핵심 인용: "Die raumbezogene Architektur wurde speziell für Probleme entwickelt, die hohe Skalierbarkeit, Elastizität und Gleichzeitigkeit erfordern." (공간 기반 아키텍처는 높은 확장성, 탄력성, 동시성을 요구하는 문제를 위해 특별히 개발되었습니다.)

## 2. 공간 기반 아키텍처의 토폴로지 및 핵심 구성 요소

공간 기반 아키텍처는 **'튜플 스페이스(Tuple Space)'** 개념에서 이름을 따왔으며, 여러 병렬 프로세서가 **공유 메모리**를 통해 통신하는 기술입니다. 이 아키텍처는 중앙 데이터베이스를 **복제된 인메모리 데이터 그리드**로 대체하여 높은 확장성을 달성합니다.

![공간 기반 아키텍처 토폴로지](unnamed.png)

### 2.1. 기본 원리

* **인메모리 데이터 처리**: 애플리케이션 데이터는 메모리에 보관되고 모든 활성 처리 장치(Processing Unit)에 복제됩니다.
* **비동기 데이터베이스 업데이트**: 처리 장치가 데이터를 업데이트하면, 데이터 펌프를 통해 비동기적으로 데이터베이스에 전송됩니다.
* **동적 확장**: 사용자 부하에 따라 처리 장치가 동적으로 시작되고 종료되어 탄력성을 확보합니다.
* **데이터베이스 병목 제거**: 표준 트랜잭션 처리에서 중앙 데이터베이스가 배제되므로 병목 현상이 사라지고 거의 무한한 확장이 가능해집니다.

### 2.2. 주요 아티팩트

아티팩트 (Artifact)	설명
처리 장치 (Processing Unit)	웹 컴포넌트 및 백엔드 비즈니스 로직을 포함한 애플리케이션 기능을 담고 있습니다.
가상화된 미들웨어 (Virtualized Middleware)	처리 장치를 관리하고 조정하는 인프라 관련 아티팩트 모음입니다.
메시징 그리드 (Messaging Grid)	입력 요청과 세션 상태를 관리합니다.
데이터 그리드 (Data Grid)	처리 장치 간의 데이터 동기화 및 복제를 관리합니다.
프로세싱 그리드 (Processing Grid)	여러 처리 장치 간의 요청 오케스트레이션을 관리합니다.
배포 관리자 (Deployment Manager)	부하 증감에 따라 처리 장치의 시작 및 종료를 관리합니다.
데이터 펌프 (Data Pump)	업데이트된 데이터를 비동기적으로 데이터베이스에 전송합니다.
데이터 라이터 (Data Writer)	데이터 펌프로부터 업데이트를 수신하여 데이터베이스를 실행합니다.
데이터 리더 (Data Reader)	시작 시 데이터베이스 데이터를 읽어 처리 장치에 전달합니다.



## 3. 구성 요소 상세 분석

### 3.1. 처리 장치 (Processing Unit)

**처리 장치**는 애플리케이션 로직을 포함하며, 소규모 애플리케이션은 단일 처리 장치로, 대규모 애플리케이션은 기능 영역별로 여러 처리 장치로 분할될 수 있습니다. 각 처리 장치에는 **인메모리 데이터 그리드**와 **복제 엔진**이 포함되어 있습니다.

### 3.2. 가상화된 미들웨어 (Virtualized Middleware)

인프라 관련 기능을 관리하는 **제어부 역할**을 합니다. 최소한 **메시징 그리드**, **데이터 그리드**, **배포 관리자**를 포함하며, 필요에 따라 프로세싱 그리드나 보안, 메트릭 수집 같은 기능을 추가할 수 있습니다. 일반적으로 단일 제품이 아닌 웹 서버, 캐싱 도구, 로드 밸런서 등의 조합으로 구현됩니다.

### 3.3. 데이터 그리드 (Data Grid)

이 아키텍처에서 **가장 중요한 구성 요소**일 수 있습니다. 메시징 그리드가 어떤 처리 장치로든 요청을 전달할 수 있기 때문에, 각 처리 장치의 인메모리 데이터 그리드는 **정확히 동일한 데이터**를 포함해야 합니다.

* **데이터 복제**: 데이터 업데이트는 일반적으로 100ms 미만 내에 다른 처리 장치로 비동기적으로 복제됩니다.
* **멤버십 관리**: 각 처리 장치 인스턴스는 동일한 캐시를 공유하는 다른 모든 인스턴스의 IP 주소와 포트 목록을 유지합니다. 새로운 인스턴스가 시작되거나 기존 인스턴스가 다운되면 이 목록은 자동으로 업데이트됩니다. 이를 통해 한 인스턴스에서 발생한 캐시 업데이트가 다른 모든 인스턴스에 전파될 수 있습니다.

### 3.4. 캐싱 전략

공간 기반 아키텍처는 트랜잭션 처리를 위해 **캐싱에 크게 의존**하며, 데이터베이스에 대한 직접적인 읽기/쓰기를 제거합니다.

**복제 캐싱 (Replicated Caching)**

* **구조**: 각 처리 장치가 자체 인메모리 데이터 그리드를 가지며, 동일한 캐시를 사용하는 모든 처리 장치 간에 동기화됩니다.
* **장점**: 매우 빠르며, 중앙 서버가 없어 **단일 장애점(Single Point of Failure)** 이 없으므로 높은 내결함성을 제공합니다.
* **단점**:
  * **대용량 데이터**: 캐시 크기가 100MB를 초과하면 각 처리 장치가 많은 메모리를 소모하여 탄력성 문제를 일으킬 수 있습니다.
  * **빈번한 업데이트**: 업데이트 빈도가 너무 높으면 데이터 그리드가 따라가지 못해 데이터 일관성이 손상될 수 있습니다(**데이터 충돌**).

**분산 캐싱 (Distributed Caching)**

* **구조**: 외부 서버나 서비스가 중앙 캐시를 유지하고, 처리 장치는 전용 프로토콜을 통해 데이터를 원격으로 가져옵니다.
* **장점**: 데이터가 한 곳에 저장되므로 높은 수준의 **데이터 일관성**을 제공합니다.
* **단점**:
  * **성능 저하**: 원격 접근으로 인해 시스템의 전체 지연 시간이 증가하여 복제 캐싱보다 성능이 떨어집니다.
  * **내결함성 문제**: 중앙 캐시 서버가 다운되면 모든 처리 장치가 데이터에 접근할 수 없는 단일 장애점이 발생합니다.

결정 기준 비교

결정 기준	복제 캐싱 (Replicated Cache)	분산 캐싱 (Distributed Cache)
최적화	성능 (Performance)	일관성 (Consistency)
캐시 크기	작음 (<100 MB)	큼 (>500 MB)
데이터 유형	비교적 정적 (Relatively static)	매우 동적 (Highly dynamic)
업데이트 빈도	비교적 낮음 (Relatively low)	높은 업데이트율 (High update rate)
내결함성	높음 (High)	낮음 (Low)

**니어 캐시 (Near-Cache)**

인메모리 데이터 그리드(프론트 캐시)와 분산 캐시(백킹 캐시)를 결합한 **하이브리드 모델**입니다. 그러나 각 처리 장치의 프론트 캐시가 서로 동기화되지 않아 **성능 불일치**를 유발할 수 있으므로, 공간 기반 아키텍처에서는 일반적으로 권장되지 않습니다.

### 3.5. 데이터 동기화 메커니즘 (펌프, 라이터, 리더)

* **데이터 펌프 (Data Pump)**: 처리 장치가 캐시를 업데이트할 때, 해당 업데이트를 비동기적으로 데이터베이스에 전송하는 역할을 합니다. 일반적으로 **메시징 큐**를 사용하여 신뢰성 있는 전달과 처리 장치-라이터 간의 디커플링을 보장합니다.
* **데이터 라이터 (Data Writer)**: 데이터 펌프로부터 메시지를 받아 데이터베이스를 업데이트합니다. 특정 도메인의 모든 업데이트를 처리하는 **'도메인 기반' 모델** 또는 각 처리 장치 클래스에 전용으로 할당되는 모델로 구현될 수 있습니다.
* **데이터 리더 (Data Reader)**: 데이터베이스에서 데이터를 읽어 처리 장치로 전송합니다. 이는 모든 처리 장치 인스턴스가 다운되거나 재배포될 때, 또는 캐시에 없는 보관 데이터를 조회할 때와 같이 **예외적인 상황**에서만 호출됩니다.

## 4. 아키텍처 고려사항

### 4.1. 클라우드 환경

이 아키텍처는 전체 시스템을 클라우드 또는 온프레미스에 배포할 수 있을 뿐만 아니라, 두 환경에 동시에 배포하는 독특하고 강력한 **하이브리드 토폴로지**를 지원합니다.

* **하이브리드 토폴로지**: 처리 장치와 미들웨어는 관리형 클라우드 환경에 배포하고, 물리적 데이터베이스는 온프레미스에 유지할 수 있습니다. 비동기 데이터 펌프 덕분에 효과적인 클라우드 기반 데이터 동기화가 가능합니다.
* **장점**: 트랜잭션 처리는 동적이고 탄력적인 클라우드에서 수행하고, 데이터 관리 및 분석은 보안이 강화된 온프레미스 환경에서 유지할 수 있습니다.

### 4.2. 공통적인 위험 요소

**데이터 충돌 (Data Collisions)**

복제 캐싱 사용 시, 한 캐시 인스턴스(A)의 데이터가 업데이트되어 다른 인스턴스(B)로 복제되는 동안, 인스턴스 B에서도 동일한 데이터를 업데이트할 때 발생합니다. 이는 캐시 데이터의 업데이트 속도가 **복제 지연 시간(Replication Latency, RL)** 을 초과할 때 주로 발생합니다.

* **충돌률 공식**: CollisionRate = (N * UR^2) / (S * RL)
  * N: 서비스 인스턴스 수
  * UR: 업데이트 속도(ms)
  * S: 캐시 크기(행 수)
  * RL: 복제 지연 시간(ms)
* **영향 요인**: 인스턴스 수와 업데이트 속도가 높을수록, 캐시 크기가 작을수록, 복제 지연 시간이 길수록 충돌 가능성이 증가합니다.

**기타 위험**

* **빈번한 데이터베이스 읽기**: 캐시에 없는 데이터를 자주 읽게 되면 아키텍처의 확장성 이점이 사라집니다.
* **데이터 동기화 지연**: 데이터 펌프의 병목 현상은 캐시와 데이터베이스 간의 데이터 일관성에 상당한 지연을 초래할 수 있습니다.
* **높은 데이터 볼륨**: 처리 장치의 메모리가 고갈되어 다운될 수 있으므로 인메모리 캐시 크기를 신중하게 관리해야 합니다.

### 4.3. 거버넌스

복잡한 아키텍처이므로 성공적인 운영을 위해 적절한 **거버넌스**가 필수적입니다. **자동화된 거버넌스 피트니스 함수(fitness function)** 를 통해 주요 지표를 지속적으로 모니터링하는 것이 권장됩니다.

* **메모리 사용량 추적**: 각 처리 장치의 메모리 소비량을 모니터링합니다.
* **동기화 시간 측정**: 캐시 업데이트가 데이터베이스에 반영되기까지 걸리는 시간을 추적합니다.
* **데이터 펌프 병목 분석**: 데이터 펌프의 큐 깊이를 추적하여 병목 현상을 감지합니다.

## 5. 아키텍처 특성 평가

아키텍처 특성	별점 평가
전체 비용 (Overall cost)	
파티셔닝 유형 (Partitioning type)	기술적 (Technical)
퀀텀 수 (Number of quanta)	1 ~ 다수 (1 to many)
단순성 (Simplicity)	★☆☆☆☆
모듈성 (Modularity)	★★★☆☆
유지보수성 (Maintainability)	★★★☆☆
테스트 용이성 (Testability)	★☆☆☆☆
배포 용이성 (Deployability)	★★★★☆
진화성 (Evolvability)	★★★☆☆
응답성 (Responsiveness)	★★★★★
확장성 (Scalability)	★★★★★
탄력성 (Elasticity)	★★★★★
내결함성 (Fault tolerance)	★★☆☆☆

* **최고의 강점**: 응답성, 확장성, 탄력성은 5점 만점을 받았습니다. 이는 **인메모리 데이터 캐싱**을 활용하고 **데이터베이스 제약을 제거**함으로써 달성됩니다.
* **명확한 단점**:
  * **단순성 & 테스트 용이성**: 아키텍처가 매우 복잡하고, 수십만 동시 사용자를 시뮬레이션하는 대규모 부하 테스트가 어렵고 비용이 많이 들어 각각 1점을 받았습니다.
  * **비용**: 복잡성, 캐싱 제품 라이선스, 대규모 자원 사용으로 인해 비용이 많이 듭니다.

## 6. 적용 사례

공간 기반 아키텍처는 **사용자나 요청 볼륨이 급증**하는 애플리케이션에 매우 적합합니다.

* **콘서트 티켓 예매 시스템**: 인기 콘서트 티켓 판매가 시작되면 동시 사용자 수가 수만 명으로 급증합니다. 이 시스템은 극심한 부하를 짧은 시간 동안 처리해야 하므로 높은 **탄력성**이 필수적입니다. 공간 기반 아키텍처는 배포 관리자를 통해 갑작스러운 부하 증가를 감지하고 필요한 수의 처리 장치를 즉시 가동하여 대량의 구매 요청을 처리할 수 있습니다.
* **온라인 경매 시스템**: 경매가 시작되면 얼마나 많은 사람이 참여하고 동시에 입찰할지 예측하기 어렵습니다. 사용자 및 요청 부하에 **예측 불가능한 급증**이 발생합니다. 공간 기반 아키텍처는 부하가 증가할 때 여러 처리 장치를 시작하고, 경매가 끝나면 이를 제거하여 자원을 효율적으로 사용할 수 있게 합니다.
